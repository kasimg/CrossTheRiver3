{"version":3,"sources":["MainScript.js"],"names":["cc","Class","extends","Component","properties","animalPrefab","default","type","Prefab","tigers","deers","boat","Node","riverBankInfo","GoBtn","rulesBtn","Label","ruleContext","RichText","creatActors","i","tiger","instantiate","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","Sprite","mainScript","animalIndex","animalType","node","addChild","push","deer","setActorPos","length","posX","Data","tigerPositionLeft","x","posY","y","setPosition","deerPositionLeft","boatPositionLeft","initRiverBankInfo","left","tigerNum","deerNum","right","initBackground","bindGoEvent","on","EventType","MOUSE_DOWN","onGoBtnClicked","removeGoEvent","off","onMouseEnter","game","canvas","style","cursor","scale","onMouseLeave","bindEnterAndLeave","MOUSE_ENTER","MOUSE_LEAVE","isEmpty","Math","abs","sailTo","ifGameOver","gameOver","removeAnimalClickEvent","removeClickEvent","bindAnimalClickEvent","bindClickEvent","pos","allTheWay","boatIns","boatStr","passageStr","boatSailAction","sail","delX","delY","se","sequence","callFunc","runAction","passages","seats","seatIndex","state","boatInfo","boatStatus","addFlag","forEach","atLeft","onBoat","passage","console","log","eatAction","eatDeer","opacity","director","loadScene","ifSucceeded","succeed","showRules","tween","to","start","onRulesBtnClick","onRulesBtnHover","onRulesBtnLeave","bindRulesBtnEvent","onLoad","zindex","update","dt"],"mappings":"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","file":"MainScript.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\nimport Data from 'Data';\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n    animalPrefab: {\n      default: null,\n      type: cc.Prefab,\n    },\n    // deerPrefab: {\n    //   default: null,\n    //   type: cc.Prefab,\n    // },\n    tigers: [],  //  存放3只老虎\n    deers: [],  //  存放3只鹿\n    boat: {\n      default: null,\n      type: cc.Node,\n    },\n    riverBankInfo: {\n      default: null,\n    },  //  存放两边岸上的情况\n    GoBtn: {\n      default: null,\n      type: cc.Node,\n    },\n    rulesBtn: {  //  点击弹出游戏规则\n      default: null,\n      type: cc.Label,\n    },\n    ruleContext: {\n      default: null,\n      type: cc.RichText,\n    }\n  },\n\n  //  创建角色\n  creatActors() {\n    //  创建老虎\n    for (let i = 0; i < 3; i++) {\n      //  创建老虎\n      const tiger = cc.instantiate(this.animalPrefab);\n      cc.loader.loadRes('tiger', cc.SpriteFrame, (err, spriteFrame) => {\n        tiger.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n      });\n\n      tiger.getComponent('Animal').mainScript = this;\n      tiger.getComponent('Animal').animalIndex = i;\n      tiger.getComponent('Animal').animalType = 'tiger';\n      this.node.addChild(tiger);\n      this.tigers.push(tiger);\n    }\n\n    //  创建鹿\n    for (let i = 0; i < 3; i++) {\n      //  创建鹿\n      const deer = cc.instantiate(this.animalPrefab);\n      cc.loader.loadRes('deer', cc.SpriteFrame, (err, spriteFrame) => {\n        deer.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n      });\n\n      deer.getComponent('Animal').mainScript = this;\n      deer.getComponent('Animal').animalIndex = i;\n      deer.getComponent('Animal').animalType = 'deer';\n      this.node.addChild(deer);\n      this.deers.push(deer);\n    }\n  },\n\n  //  设置老虎和鹿的初始位置\n  setActorPos() {\n    for (let i = 0; i < this.tigers.length; i++) {\n      const tiger = this.tigers[i];\n      let posX = Data.tigerPositionLeft[i].x;\n      let posY = Data.tigerPositionLeft[i].y;\n\n      // tiger.x = posX;\n      // tiger.y = posY;\n\n      tiger.setPosition(posX, posY);\n\n      const deer = this.deers[i];\n      posX = Data.deerPositionLeft[i].x;\n      posY = Data.deerPositionLeft[i].y;\n\n      // deer.x = posX;\n      // deer.y = posY;\n      // console.log(deer.x, deer.y);\n      deer.setPosition(posX, posY);\n\n    }\n\n    //  设置船的初始位置\n    this.boat.setPosition(Data.boatPositionLeft.x, Data.boatPositionLeft.y);\n  },\n\n  //  初始化河岸数组\n  initRiverBankInfo() {\n    this.riverBankInfo = {\n      left: {\n        tigerNum: 3,\n        deerNum: 3,\n      },\n      right: {\n        tigerNum: 0,\n        deerNum: 0,\n      },\n    };\n  },\n\n  //  初始化界面\n  initBackground() {\n    this.creatActors();\n    this.setActorPos();\n    this.initRiverBankInfo();\n  },\n\n  //  绑定GO按钮点击事件\n  bindGoEvent() {\n    this.GoBtn.on(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\n  },\n\n  //  解除GO按钮点击事件\n  removeGoEvent() {\n    this.GoBtn.off(cc.Node.EventType.MOUSE_DOWN, this.onGoBtnClicked, this);\n  },\n\n  //  鼠标悬停事件\n  onMouseEnter() {\n    cc.game.canvas.style.cursor = 'pointer';\n    this.GoBtn.scale = 0.21;\n    // this.GoBtn.runAction(cc.scaleBy(0.2, 1.2));\n  },\n\n  //  鼠标离开事件\n  onMouseLeave() {\n    cc.game.canvas.style.cursor = 'default';\n    this.GoBtn.scale = 0.19;\n    // this.GoBtn.runAction(cc.scaleBy(0.2, 5 / 6));\n  },\n\n  //  绑定悬停和离开事件\n  bindEnterAndLeave() {\n    this.GoBtn.on(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\n    this.GoBtn.on(cc.Node.EventType.MOUSE_LEAVE, this.onMouseLeave, this);\n  },\n\n  //  注销悬停和离开事件\n\n  //  点击GO之后的事件\n  onGoBtnClicked() {\n    // console.log('点击了一次');\n    if (!this.boat.getComponent('Boat').isEmpty()) {  //  只有船上有乘客的时候才能开船\n    //  根据船的位置确定往哪里走，实际操作中有可能出现误差，所以这里给出一定的余地\n    if (Math.abs(this.boat.x - Data.boatPositionLeft.x) < 10) {  //  如果在左边\n      //  移动船\n      this.sailTo('right');\n      //  离开左岸的判定\n      if (this.ifGameOver('left', 'leave')) {\n        this.gameOver('left', 'leave');\n      }\n    } else {\n      this.sailTo('left');\n      //  离开右岸的判定\n      if (this.ifGameOver('right', 'leave')) {\n        this.gameOver('right', 'leave');\n      }\n    }\n    }\n  },\n\n  //  移除所有动物的点击事件\n  removeAnimalClickEvent() {\n    // console.log('remove');\n    for (let i = 0; i < this.tigers.length; i++) {\n      this.tigers[i].getComponent('Animal').removeClickEvent();\n      this.deers[i].getComponent('Animal').removeClickEvent();\n    }\n  },\n\n  //  绑定多有动物的点击事件\n  bindAnimalClickEvent() {\n    for (let i = 0; i < this.tigers.length; i++) {\n      this.tigers[i].getComponent('Animal').bindClickEvent();\n      this.deers[i].getComponent('Animal').bindClickEvent();\n    }\n  },\n\n  /**\n   * 向指定方向航行指定的路程\n   * @param {string} pos \b航行的方向，可以为'left'或者’right‘\n   * @param {boolean} allTheWay 是否航行全程，默认为true\n   */\n  sailTo(pos, allTheWay = true) {\n    const boatIns = this.boat.getComponent('Boat');\n    const boatStr = 'boatPosition' + (pos === 'right' ? 'Right' : 'Left');\n    const passageStr = pos + 'Pos';\n    // console.log(Data[boatStr], boatStr);\n    // console.log(pos);\n    // console.log('从', {x: this.boat.x, y: this.boat.y}, '开往', Data[boatStr])\n    const boatSailAction = boatIns.sail({\n      delX: Data[boatStr].x - this.boat.x,\n      delY: Data[boatStr].y - this.boat.y,\n    });\n\n    //  移除点击事件，防止连续点击\n    this.removeGoEvent();\n    this.removeAnimalClickEvent();\n    // const actionArr = [];\n    // actionArr.push(boatSailAction);\n    const se = cc.sequence(boatSailAction, cc.callFunc(() => {\n      // console.log('动作执行完毕');\n      //  动作执行完之后，重新绑定事件\n      this.bindGoEvent();\n      this.bindAnimalClickEvent();\n\n      // console.log(this.riverBankInfo);\n      //  判断是否游戏结束\n      if (this.ifGameOver(pos, 'arrive')) {\n        this.gameOver(pos, 'arrive');\n      } else {\n        // console.log('继续');\n      }\n    }, this));\n    this.boat.runAction(se);\n\n    const passages = boatIns.passages;\n    // if (!boatIns.isEmpty()) {\n    for (let i = 0; i < passages.length; i++) {\n      if (passages[i]) {\n        passages[i].sail({\n          delX: boatIns.seats[passages[i].seatIndex][passageStr].x - passages[i].node.x,\n          delY: boatIns.seats[passages[i].seatIndex][passageStr].y - passages[i].node.y,\n        });\n      }\n\n    }\n    // }\n  },\n\n  // 判定游戏是否结束\n  //  pos表示判断哪一岸的情况\n  //  state表示离岸还是靠岸\n  ifGameOver(pos, state) {\n    const boatInfo = this.boat.getComponent('Boat');\n    // console.log(this.riverBankInfo, boatInfo);\n    if (state === 'leave') { //  离开岸边，不用加上船上的动物数量\n      if (this.riverBankInfo[pos].deerNum < 1) return false;  //  如果没有鹿，不可能游戏结束\n      if (this.riverBankInfo[pos].tigerNum > this.riverBankInfo[pos].deerNum) return true;\n    } else {\n      if (this.riverBankInfo[pos].deerNum + boatInfo.boatInfo.deerNum < 1) return false;\n      if (this.riverBankInfo[pos].tigerNum + boatInfo.boatInfo.tigerNum\n        > this.riverBankInfo[pos].deerNum + boatInfo.boatInfo.deerNum) return true;\n    }\n    return false;\n  },\n\n  //  游戏结束时执行\n  /**\n   * \n   * @param {string} pos 左岸发生还是右岸发生，值为'left'或者'right'\n   * @param {string} boatStatus 船的状态，可以为’arrive‘或者’leave‘\n   */\n  gameOver(pos, boatStatus) {\n    const tigers = [];\n    const deers = [];\n    // console.log(pos, boatStatus);\n    const addFlag = true;\n    if (pos === 'left') {\n      //  获取岸上的老虎对象\n      this.tigers.forEach((tiger) => {\n        if (tiger.getComponent('Animal').atLeft()) tigers.push(tiger);\n      });\n      //  获取岸上的鹿对象\n      this.deers.forEach((deer) => {\n        if (deer.getComponent('Animal').atLeft()) deers.push(deer);\n      });\n    } else {\n      //  获取岸上的老虎对象\n      this.tigers.forEach((tiger) => {\n        if (!tiger.getComponent('Animal').atLeft() && !tiger.getComponent('Animal').onBoat) tigers.push(tiger);\n      });\n      //  获取岸上的鹿对象\n      this.deers.forEach((deer) => {\n        if (!deer.getComponent('Animal').atLeft() && !deer.getComponent('Animal').onBoat) deers.push(deer);\n      });\n    }\n\n    if (boatStatus === 'arrive') {  //  到达左岸的情形\n      // console.log('到达岸边');\n      //  把船上的动物也加上\n      // console.log(this.boat.getComponent('Boat').passages);\n      this.boat.getComponent('Boat').passages.forEach((passage) => {\n        if (passage) {\n          if (passage.animalType === 'tiger') {\n            tigers.push(passage.node);\n          } else {\n            deers.push(passage.node);\n          }\n        }\n      });\n    }\n\n    //  播放老虎吃鹿的动画\n    console.log(tigers, deers);\n    for (let i = 0; i < deers.length; i++) {\n      // console.log(deers[i].x, tigers[i].x);\n      const eatAction = tigers[i].getComponent('Animal').eatDeer({\n        delX: deers[i].x - tigers[i].x,\n        delY: deers[i].y - tigers[i].y,\n      });\n      const se = cc.sequence(eatAction, cc.callFunc(() => {\n        // console.log('eating finished');\n        deers[i].opacity = 0;\n        if (i === 0) cc.director.loadScene('gameOver');\n      }, this));\n\n      tigers[i].runAction(se);\n    }\n    // cc.director.loadScene('gameOver');\n  },\n\n  //  判断是否胜利\n  ifSucceeded() {\n    //  如果右岸动物总数达到6，则胜利\n    if (this.riverBankInfo.right.tigerNum + this.riverBankInfo.right.deerNum === 6) return true;\n    return false;\n  },\n\n  //  胜利后执行的操作\n  succeed() {\n    cc.director.loadScene('succeed');\n  },\n\n  //  弹出提示\n  showRules() {\n    // const ruleOpacity = this.ruleContext.node.opacity;\n    const opacity = this.ruleContext.node.opacity === 255 ? 0 : 255;\n    cc.tween(this.ruleContext.node)\n      .to(0.5, { opacity: opacity })\n      .start();\n  },\n\n  //  点击游戏规则按钮的事件\n  onRulesBtnClick() {\n    this.showRules();\n  },\n\n  onRulesBtnHover() {\n    cc.game.canvas.style.cursor = 'pointer';\n  },\n\n  onRulesBtnLeave() {\n    cc.game.canvas.style.cursor = 'default';\n  },\n\n  //  绑定游戏规则按钮事件\n  bindRulesBtnEvent() {\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_DOWN, this.onRulesBtnClick, this);\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_ENTER, this.onRulesBtnHover, this);\n    this.rulesBtn.node.on(cc.Node.EventType.MOUSE_LEAVE, this.onRulesBtnLeave, this);\n  },\n\n  onLoad() {\n    this.initBackground();\n    this.bindGoEvent();\n    this.bindEnterAndLeave();\n    this.bindRulesBtnEvent();\n    this.ruleContext.node.opacity = 0;\n    this.ruleContext.node.zindex = 99;\n    // cc.game.addPersistRootNode(this.node);\n    // console.log(this.tigers[0]);\n    // console.log(this.tigers[0]);\n    // this.tigers[0].getComponent('Animal').jump();\n  },\n\n  start() {\n\n  },\n\n  update(dt) {\n    // console.log(this.tigers[0]);\n    // this.tigers[0].getComponent('Animal').jump();\n  },\n});\n"]}