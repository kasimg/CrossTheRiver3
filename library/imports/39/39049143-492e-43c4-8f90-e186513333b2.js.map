{"version":3,"sources":["../../../../assets/Script/assets/Script/Animal.js"],"names":["cc","Class","extends","Component","properties","atLeft","leftPos","animalType","Data","tigerPositionLeft","animalIndex","deerPositionLeft","Math","abs","node","x","jump","delX","delY","jumpAction","moveBy","v2","easing","easeCubicActionOut","jumpTween","tween","by","position","t","call","mainScript","ifSucceeded","succeed","bindAnimalClickEvent","removeAnimalClickEvent","start","getOnTheBoatFrom","pos","boat","getComponent","seatIndex","searchSeat","getOn","computeDelPos","y","seats","getOffTheBoatFrom","getOff","animalStr","directionStr","updateAnimalNum","bankInfo","riverBankInfo","boatInfo","addFlag","sail","sailAction","runAction","onClicked","onBoat","xBefore","yBefore","xAfter","yAfter","bindClickEvent","on","Node","EventType","MOUSE_DOWN","removeClickEvent","off","onMouseEnter","game","canvas","style","cursor","action1","scaleBy","action2","removeMouseEnterEvent","se","sequence","callFunc","bindMouseEnterEvent","soundType","parent","getChildByName","play","onMouseLeave","MOUSE_ENTER","MOUSE_LEAVE","eatDeer","eatAction","onLoad"],"mappings":"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","file":"Animal.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/class.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/class.html\n// Learn Attribute:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/reference/attributes.html\n//  - [English] http://docs.cocos2d-x.org/creator/manual/en/scripting/reference/attributes.html\n// Learn life-cycle callbacks:\n//  - [Chinese] https://docs.cocos.com/creator/manual/zh/scripting/life-cycle-callbacks.html\n//  - [English] https://www.cocos2d-x.org/docs/creator/manual/en/scripting/life-cycle-callbacks.html\n\nimport Data from 'Data';\ncc.Class({\n  extends: cc.Component,\n\n  properties: {\n\n  },\n\n  //  判断是否在左岸\n  atLeft() {\n    //  根据动物类型和创建时的索引确定左岸自己的位置\n    const leftPos = this.animalType === 'tiger'\n      ? Data.tigerPositionLeft[this.animalIndex]\n      : Data.deerPositionLeft[this.animalIndex];\n\n    if (Math.abs(this.node.x - leftPos.x) < 10) return true;\n    return false;\n  },\n\n  //  跳跃行为\n  jump({ delX = 0, delY = 0 }) {\n    // console.log('jump')\n    const jumpAction = cc\n      .moveBy(1, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    const jumpTween = cc.tween(this.node)\n      .by(0.5, { position: cc.v2(delX / 2, 100) }, { easing: t => t * t})\n      .by(0.3, { position: cc.v2(delX / 2, -100 + delY)}, {easing: t => t * t})\n      .call(() => {\n        //  如果是开往右岸，则判断是否游戏胜利\n        if (this.mainScript.ifSucceeded()) {\n          this.mainScript.succeed();\n        }\n        //  恢复动物点击事件\n        this.mainScript.bindAnimalClickEvent();\n      }, this)\n    //  先取消所有动物的点击事件，防止疯狂点击\n    this.mainScript.removeAnimalClickEvent();\n    jumpTween.start();\n    // this.node.runAction(cc.sequence(jumpAction, cc.callFunc(() => {\n    //   //  如果是开往右岸，则判断是否游戏胜利\n    //   if (this.mainScript.ifSucceeded()) {\n    //     this.mainScript.succeed();\n    //   }\n    //   //  恢复动物点击事件\n    //   this.mainScript.bindAnimalClickEvent();\n    // }, this)));\n    // this.computeDelPos();\n  },\n\n  //  上船行为\n  getOnTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // const bankInfo = \n    const seatIndex = boat.searchSeat();\n    if (seatIndex !== -1) {\n      boat.getOn(this, seatIndex);\n      // console.log('get on the boat');\n      //  跳上船\n      this.jump(this.computeDelPos({ x: this.node.x, y: this.node.y }, boat.seats[this.seatIndex][pos === 'left' ? 'leftPos' : 'rightPos']));\n      //  更新岸上和船上的动物数量信息\n    }\n  },\n\n  //  下船行为\n  getOffTheBoatFrom(pos) {\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // console.log('get off the boat');\n    boat.getOff(this, this.seatIndex);\n\n    //  跳下船\n    const animalStr = this.animalType === 'tiger' ? 'tigerPosition' : 'deerPosition';\n    const directionStr = pos === 'left' ? 'Left' : 'Right';\n    this.jump(this.computeDelPos(\n      { x: this.node.x, y: this.node.y },\n      Data[animalStr + directionStr][this.animalIndex],\n    ));\n  },\n\n  //  更新船上和岸上的动物数量信息\n  //  getOn表示是否往船上跳，默认为true\n  updateAnimalNum(pos, getOn = true) {\n    const bankInfo = this.mainScript.riverBankInfo;\n    const boatInfo = this.mainScript.boat.getComponent('Boat').boatInfo;\n    // console.log(bankInfo, boatInfo, this.mainScript.boat.getComponent('Boat'));\n\n    const animalStr = this.animalType + 'Num';\n    const addFlag = getOn ? 1 : -1;\n    bankInfo[pos][animalStr] -= 1 * addFlag;\n    boatInfo[animalStr] += 1 * addFlag;\n\n    // console.log(bankInfo, boatInfo);\n  },\n\n  //  点击GO之后的移动行为\n  sail({ delX, delY }) {\n    const sailAction = cc\n      .moveBy(3, cc.v2(delX, delY))\n      .easing(cc.easeCubicActionOut());\n\n    this.node.runAction(sailAction);\n    // return sailAction;\n  },\n\n  //  点击精灵的相应事件\n  //  决定是上船还是下船，应该往哪里跳\n  onClicked() {\n    // console.log('动物被点击');\n    //  存放boat\n    const boat = this.mainScript.boat.getComponent('Boat');\n    // this.atLeft();\n    // console.log(boat.atLeft());\n    //  如果船在左岸\n    // console.log(this.onBoat);\n    if (boat.atLeft()) {\n      // console.log('船在左岸');\n      // console.log(this.onBoat);\n      if (this.onBoat) {  //  此时一定是在船上，而且是在左边\n        // console.log('动物在船上');\n        this.getOffTheBoatFrom('left');\n        this.updateAnimalNum('left', false);\n      } else if (this.atLeft()) {  //  否则在岸上\n        // console.log('动物在岸上');\n        this.getOnTheBoatFrom('left');\n        this.updateAnimalNum('left');\n      }\n    } else {  //  船在右岸\n      // console.log('船在右岸');\n      if (this.onBoat) {  //  在船上，且在右边\n        this.getOffTheBoatFrom('right');\n        this.updateAnimalNum('right', false);\n      } else if (!this.atLeft()) {  //  不在船上，在右岸上\n        // console.log('动物在右岸')\n        this.getOnTheBoatFrom('right');\n        this.updateAnimalNum('right');\n      }\n    }\n  },\n\n  //  计算位移量\n  computeDelPos({ x: xBefore, y: yBefore }, { x: xAfter, y: yAfter }) {\n    return {\n      delX: xAfter - xBefore,\n      delY: yAfter - yBefore,\n    };\n  },\n\n  //  绑定鼠标点击跳跃事件\n  bindClickEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  //  移除鼠标点击事件\n  removeClickEvent() {\n    this.node.off(cc.Node.EventType.MOUSE_DOWN, this.onClicked, this);\n  },\n\n  //  鼠标移动到动物身上后的事件\n  onMouseEnter() {\n    cc.game.canvas.style.cursor = 'pointer';\n    //  弹跳效果\n    const action1 = cc.scaleBy(0.2, 1.2);\n    const action2 = cc.scaleBy(0.3, 5 / 6);\n    //  取消悬停事件\n    this.removeMouseEnterEvent();\n    const se = cc.sequence(action1, action2, cc.callFunc(() => {\n      this.bindMouseEnterEvent();\n    }, this));\n    this.node.runAction(se);\n\n    //  发出声音\n    const soundType = this.animalType === 'tiger' ? 'tigerRoar' : 'deerSound';\n    this.node.parent.getChildByName('audioControl').getComponent('AudioControl')[soundType].play();\n    // console.log(this.node.parent.getChildByName('audioControl'));\n  },\n\n  //  鼠标移出动物后的事件\n  onMouseLeave() {\n    cc.game.canvas.style.cursor = 'default';\n  },\n\n  //  绑定鼠标悬停和移出事件事件\n  bindMouseEnterEvent() {\n    this.node.on(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\n    this.node.on(cc.Node.EventType.MOUSE_LEAVE, this.onMouseLeave, this);\n\n  },\n\n  //  移除鼠标悬停事件\n  removeMouseEnterEvent() {\n    this.node.off(cc.Node.EventType.MOUSE_ENTER, this.onMouseEnter, this);\n  },\n\n  /**\n   * 老虎吃鹿的动画\n   * @param {number} delX 横向位移量\n   * @param {number} delY 纵向位移量\n   * @return {} 动作对象\n   */\n  eatDeer({ delX, delY }) {\n    const eatAction = cc.moveBy(1, delX, delY);\n    return eatAction;\n  },\n\n  onLoad() {\n    this.bindClickEvent();\n    this.bindMouseEnterEvent();\n    // console.log(this.atLeft());\n  },\n\n  start() {\n\n  },\n\n  // update (dt) {},\n});\n"]}